<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Taste Trek</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }
    #map {
      height: 100%;
      width: 100%;
    }
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 280px;
      height: 100%;
      background: white;
      z-index: 999;
      padding: 10px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.2);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }
    #sidebar.active {
      transform: translateX(0);
    }
    #toggleSidebar {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1000;
      padding: 6px 12px;
      background: #4285f4;
      color: white;
      border: none;
      border-radius: 4px;
    }
    label, select, input, button {
      display: block;
      width: 100%;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <button id="toggleSidebar">â˜°</button>
  <div id="sidebar">
    <h2>Add Dish</h2>
    <form id="dishForm">
      <label>Dish Name</label>
      <input type="text" id="dishName" required /><label>Category</label>
  <select id="category" required>
    <option value="">Choose...</option>
    <option value="Street Food">Street Food</option>
    <option value="Fine Dining">Fine Dining</option>
    <option value="Traditional">Traditional</option>
    <option value="Fast Food">Fast Food</option>
  </select>

  <button type="submit">Add Dish</button>
</form>

  </div>
  <div id="map"></div>  <script>
    let map;
    let markers = [];
    let currentLatLng;

    document.getElementById("toggleSidebar").addEventListener("click", () => {
      document.getElementById("sidebar").classList.toggle("active");
    });

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 20.5937, lng: 78.9629 },
        zoom: 5,
        mapTypeId: "roadmap",
      });

      map.addListener("click", (e) => {
        currentLatLng = e.latLng;
        document.getElementById("sidebar").classList.add("active");
      });

      const saved = JSON.parse(localStorage.getItem("tastetrek") || "[]");
      saved.forEach(addMarker);
    }

    document.getElementById("dishForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("dishName").value;
      const cat = document.getElementById("category").value;
      if (!name || !cat || !currentLatLng) return;

      const country = await getCountryName(currentLatLng);
      const dish = {
        name,
        cat,
        lat: currentLatLng.lat(),
        lng: currentLatLng.lng(),
        country
      };
      addMarker(dish);
      saveToLocal();
      e.target.reset();
      document.getElementById("sidebar").classList.remove("active");
    });

    function addMarker(dish) {
      const marker = new google.maps.Marker({
        position: { lat: dish.lat, lng: dish.lng },
        map,
        title: dish.name
      });

      const info = new google.maps.InfoWindow({
        content: `<strong>${dish.name}</strong><br>${dish.cat}<br>${dish.country}<br><button onclick="removeDish(${dish.lat}, ${dish.lng})">Delete</button>`
      });

      marker.addListener("click", () => info.open(map, marker));
      markers.push({ marker, dish });
    }

    function removeDish(lat, lng) {
      markers = markers.filter(({ marker, dish }) => {
        if (dish.lat === lat && dish.lng === lng) {
          marker.setMap(null);
          return false;
        }
        return true;
      });
      saveToLocal();
    }

    function saveToLocal() {
      localStorage.setItem("tastetrek", JSON.stringify(markers.map(({ dish }) => dish)));
    }

    async function getCountryName(latlng) {
      const url = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${latlng.lat()},${latlng.lng()}&key=YOUR_API_KEY`;
      const res = await fetch(url);
      const data = await res.json();
      const country = data.results[0]?.address_components.find(c => c.types.includes("country"));
      return country ? country.long_name : "Unknown";
    }
  </script>  
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDQfu8shg7gxSuDsmuRXQWVTJ7UcuPYhjM&callback=initMap" async defer></script>
</body>
</html>
